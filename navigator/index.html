<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>ICQ</title>
<script src="libs/jquery.js"></script>
<script src="libs/jqueryrotate.2.1.js"></script>
<script src="libs/crafty-min.js"></script>
<script src="libs/greensock/easing/EasePack.min.js"></script>
<script src="libs/greensock/TweenLite.min.js"></script>
<script src="libs/greensock/plugins/CSSPlugin.min.js"></script>
<style type="text/css">
body{
    padding:0;
    margin:0;
}

.menu{
    height:300px; width:200px; float:left; 
	border:solid #000000 3px; border-radius:5px;
    }
.menu a {text-decoration:none; color:#000;}
.hide_list {
height:230px; 
/*width:200px; */
width:100%;
overflow:hidden;
}
/*
.hide_list a:link {
background-color:#fff; color:#fff; text-decoration:none;
}
.hide_list a:hover {
background-color:#0033cc; color:#000; text-decoration:none;
}
*/

.users:hover {
background-color:#0033cc; color:#fff; text-decoration:none;
}
.users {
/*width:100%;*/
height:36px; 
border-bottom:solid #CCCCCC 1px; margin-left:5px; 
width:200px;
}
.user_img {
float:left; display:block;
}
.user_name {
float:left; display:block; margin-left:35px; margin-right:35px; margin-top:8px;
}
.user_online {
float:right; display:block; margin-top:14px; margin-right:20px;
}

.right_module{
    float:right;
    background-color:#CCFF00;
    width:235px; 
    height:305px;
}
.child_content {
    height:305px;
    background-color:#00FF99; 
    margin-left:200px;
    margin-right:235px;
    overflow:hidden;
}
@media (max-width: 700px) {
.right_module {display:none}
.child_content {margin-right:0}
}
@media (max-width: 400px) {
.menu, .right_module {display:none}
.child_content {margin:0}
}
</style>
</head>

<body>
<div class="container">
<div class="menu">
<div><img src="img/title.png" width="200" height="14" /></div>

<div style="background-color:#d0d2d0; width:100%; height:25px">
<div style="float:left; display:inline"><img src="img/shapka_img.png" width="92" height="25" /></div>
<div style="margin-left:99px; margin-right:25px; padding-top:5px; font-size:12px; font-weight:bold;"> Доступен</div>
<div style="float:right; display:inline; margin-top:-10px; margin-right:15px"><img src="img/green_point.png" width="10" height="9" /></div>
</div>

<a href="#"><div onClick="slideToggleDiv();" style="background-color:#ffffcc; width:200px; height:20px;"><img src="img/strelka.png" width="10" height="10" class="arrow" /> Main Group</div></a>
<div class="hide_list">
<a class="users_click0" href="#"><div class="users">
<div class="user_img"><img src="img/user1.png" width="34" height="34" /></div><div class="user_name">Users 0</div><div class="user_online"><img src="img/green_point.png" width="10" height="9" /></div></div></a>

<a class="users_click1" href="#"><div class="users">
<div class="user_img"><img src="img/user2.png" width="34" height="34" /></div><div class="user_name">Users 1</div><div class="user_online"><img src="img/green_point.png" width="10" height="9" /></div></div></a>

<a class="users_click2" href="#"><div class="users">
<div class="user_img"><img src="img/user3.png" width="34" height="34" /></div><div class="user_name">Users 2</div><div class="user_online"><img src="img/green_point.png" width="10" height="9" /></div></div></a>

<a class="users_click3" href="#"><div class="users">
<div class="user_img"><img src="img/user4.png" width="34" height="34" /></div><div class="user_name">Users 3</div><div class="user_online"><img src="img/green_point.png" width="10" height="9" /></div></div></a>

<a class="users_click4" href="#"><div class="users">
<div class="user_img"><img src="img/user5.png" width="34" height="34" /></div><div class="user_name">Users 4</div><div class="user_online"><img src="img/green_point.png" width="10" height="9" /></div></div></a>

<a class="users_click5" href="#"><div class="users">
<div class="user_img"><img src="img/user6.png" width="34" height="34" /></div><div class="user_name">Users 5</div><div class="user_online"><img src="img/green_point.png" width="10" height="9" /></div></div></a>

<a class="users_click6" href="#"><div class="users">
<div class="user_img"><img src="img/user7.png" width="34" height="34" /></div><div class="user_name">Users 6</div><div class="user_online"><img src="img/grey_point.png" width="10" height="9" /></div></div></a>
</div></div>
<div class="right_module">
Календарь
  Однако Северский Донец – река самобытная. Об этом можно догадаться, если взглянуть на карту 
  Ростовской области, особенно – на её южную часть. Вот – посёлок Углегорский. Вот – город Каменск-Шахтинский. Вот – гора Свистуха, недалёко от Каменск-Шахтинского. </div>
  </div>
  <div class="child_content">
<div id="cr-stage"></div>
</div>
<div class="test"></div>
<script>
var cvetok_arr = []; var red_target; var yellow_target; var coord_arr = [[300,250], [350,120], [510,250], [550,100], [650,250], [620,110]];
var keys_arr = [];
Game = {

start: function(sceneName) {


///////////////////////////////////////////
//////////SCENE: Menu /////////////////////
///////////////////////////////////////////
Crafty.defineScene("Menu", function () {
		var cvetok_count = -1; var count_of_click = 0; var clickMenu_count=0;
       Crafty.background('#fff'); //background
	   Crafty.viewport.init($('#cr-stage').width(), $('#cr-stage').height());
	   Crafty.viewport.bounds = {min:{x:0, y:0}, max:{x:500, y:500}};
	   
var karta = Crafty.e("2D, Canvas, Tween, googlemap").attr({alpha:0, x:-300, y:-500, z:0, w:1600, h:1126});//оригинал 1600 x 521
red_target = Crafty.e("2D, DOM, Tween, red_target").attr({x:coord_arr[0][0], y:coord_arr[0][1], z:2, w:35, h:35, alpha:0});
yellow_target = Crafty.e("2D, DOM, Tween, yellow_target").attr({x:-100, y:100, z:1, w:40, h:40, alpha:0});
Crafty.viewport.clampToEntities = false;
	$('.test').append("cr-stage w "+$('#cr-stage').width()+" cr-stage h "+$('#cr-stage').height());
	
		
		//Crafty.viewport.centerOn(yellow_target, 200);
		
		
var maps_event = function() {
	$(".test").append('Появляется карта');
	karta.tween({alpha:1}, 500);
	event_timer.delay(cvetok_events, 400, 6); //запуск ф-ций с цветками
	}
	   var cvetok_events = function() {
	   cvetok_count += 1;
	   
			switch(cvetok_count){
			case 0: cvetok_arr[cvetok_count].tween({alpha:1, x:coord_arr[0][0], y:coord_arr[0][1], w:35, h:35}, 500); break;
			case 1: cvetok_arr[cvetok_count].tween({alpha:1, x:coord_arr[1][0], y:coord_arr[1][1], w:35, h:35}, 500); break;
			case 2: cvetok_arr[cvetok_count].tween({alpha:1, x:coord_arr[2][0], y:coord_arr[2][1], w:35, h:35}, 500); break;
			case 3: cvetok_arr[cvetok_count].tween({alpha:1, x:coord_arr[3][0], y:coord_arr[3][1], w:35, h:35}, 500); break;
			case 4: cvetok_arr[cvetok_count].tween({alpha:1, x:coord_arr[4][0], y:coord_arr[4][1], w:35, h:35}, 500); break;
			case 5: cvetok_arr[cvetok_count].tween({alpha:1, x:coord_arr[5][0], y:coord_arr[5][1], w:35, h:35}, 500); 
			//clickMenuFunc(); 
			event_timer.delay(auto_click, 2000, -1);
			
			break;
			default: //clickMenuFunc(); 
			yellow_target.attr({x:$('#cr-stage').width()/2});//target появляется после цветков
			/*
			$(".hide_list").mouseover(function(){
			event_timer.cancelDelay(auto_click); count_of_click=0;
			if(clickMenu_count==0){
			clickMenuFunc(); clickMenu_count ++;
			}
			
			})
			.mouseout(function(){
			clickMenu_count=0; count_of_click=0;
			event_timer.delay(auto_click, 2000, -1); //запуск ф-ций с цветками
			});
			*/
			}//end switch
	   
	   }//end cvetok_events


//************************************************************************************		
$(".hide_list").mouseover(function(){
			event_timer.cancelDelay(auto_click); count_of_click=0;
			if(clickMenu_count==0){
			clickMenuFunc(); clickMenu_count ++;
			}
			
			})
			.mouseout(function(){
			clickMenu_count=0; count_of_click=0;
			event_timer.delay(auto_click, 2000, -1); //запуск ф-ций с цветками
			});   
//***********************автоматическое переключение****************************
var auto_click = function(){
	//console.log("auto_click ");
	console.log("count_of_click!! "+count_of_click);
	for(i=0; i<=5; i++){//очистка стилей
	$('.users_click'+i+' .users').css({'background-color': '#fff', 'color': '#000'});
	}
	$('.users_click'+count_of_click+' .users').css({'background-color': '#0033cc', 'color': '#ffffff'}); //выделение пт-ов меню
	//--------
	if(!count_viewport) {
		Crafty.viewport.follow(yellow_target, 0, -200); yellow_target.alpha=1; red_target.alpha=1; count_viewport=true;
	}
	yellow_target.tween({x:coord_arr[count_of_click][0] - 2.5, y:coord_arr[count_of_click][1] - 2.5}, 500);
	//-----------
	count_of_click ++; //console.log("count_of_click!! "+count_of_click);
	if(count_of_click>5) count_of_click = 0;
	//console.log("count_of_click after "+count_of_click);
}
//************************************************************************************	   

//Клонирование
cvetok_arr[0] = Crafty.e("2D, DOM, Tween, flower").attr({alpha:0, x:450, y:150, w:200, h:200});
for(i=1; i<= 5; i++){
cvetok_arr[i] = cvetok_arr[0].clone().attr({alpha:0, x:450, y:150, w:200, h:200});
}
//clickMenuFunc();

var event_timer = Crafty.e("Delay");
event_timer.delay(maps_event, 1000, 1);//1-е карта
});
///////////////////////////////////////////
//////////SCENE: loading //////////////////
///////////////////////////////////////////
Crafty.defineScene("loading", function () { //defineScene определить сцену 
       Crafty.background('#fff');

       Crafty.e("2D, HTML") //объект html
        
		.css({ "text-align" : "center","color":"red","width":200,"height":240}) // задаем стиль
        //replace вставляем html код для визуализации прогресс бара
.replace('<div style="position:absolute;display:inline-block;left:'+(200/2-200/2)+'px;top:'+(240/2-200/2)+'px"><h1>Loading...&nbsp;<span id="progress"></span>%<br><div style="background:#FF0;width:200px"><div id="progressbar" style="position:relative;height:1em;background:#F00"></div></div></h1></div>');
		$("#progress").text('0'); //0% <span id="progress"></span>%
		//$("#info3").text('0');



var onLoad = function() {
     Crafty.enterScene(sceneName); ///ЗАПУСК ОСНОВНОЙ СЦЕНЫ
};

var onProgress=function(data) {

	val=data.percent.toFixed(0);//в data помещ знач %. percent(Crafty) toFixed(0) точность до целого. Метод JS

	if (val<100) {
		$("#progress").text(val); //знач %
		$("#progressbar").width(val*2); // прогресс. Ширина заполняющего слоя 200px Процентов 100, поэтому умножаем на 2
	} else {
		$("#progress").text('100');
		$("#progressbar").width(100*2);
	}

	//console.log('success: ' + data.src); //покажет какой ресурс был загружен
	//$("#test").text('success: '+ data.src);
};

var onError=function(data) {
	console.log('---Failed!---');
	console.log(data);
	console.log('-------------');
	alert("Ошибка загрузки ресурса:\n ["+data.src+"]"); //покажет какой ресурс не был загружен
	$(".test").append('Ошибка загрузки ресурса:\n '+ data.src);
};

////////ASSETS////////////////////////////////////////
var assets={

'Menu':	{
        'paths':{ images: "assets/menu/images/", sounds: "assets/menu/sounds/" },
        
	'sprites':{
		'googlemap.jpg':{
			"tile":1600,
			"tileh":1126,
			"map":{"googlemap":[0,0]}
		},//,еще объекты через запятую
	'icq-logo.png': {
				"tile":35,
				"tileh":35,
				"map": {"flower":[0,0], "yellow_target":[1,0], "red_target":[2,0]}
	}
	

	}
}

}; //end ASSETS/
//////////////////////////////////////////////////////////////////////
Crafty.paths(assets[sceneName]['paths']); //считывается из массива путей и помещается в Crafty.paths (243)
assets[sceneName]['paths']=[]; //из массива assets удаляются пути ресурсов для текущей сцены. Чтобы не было конфликта с Crafty.removeAssets(assets[fromScene]); (288)

////Освобождаем память для новой сцены. fromScene - из предыдущей сцены
Crafty.removeAssets(assets[fromScene]);
Crafty.assets=[]; //удаляет все ассеты

//после зачистки загружаем новую сцену
Crafty.load(
assets[sceneName], //загрузка ассетов
onLoad, //выполняется вызов объекта когда ассеты загружены
onProgress, //вызывается пока происходит загрузка
onError //выз когда ошибка
);

});

Crafty.enterScene("loading"); 

}, //end of start game


init: function() {
 
 Crafty.init(document.getElementById('cr-stage'));
  Crafty.bind('SceneChange',function (data) { //событие смены сцены. 
  fromScene=data.oldScene; //переменная fromScene из какой сцены вышли. oldScene и newScene -- значения обработчика события SceneChange переменные Crafty
  toScene=data.newScene; // toScene в какую идем. data.newScene возвращает имя сцены
  Crafty.e("2D").destroy(); //уничтожение предыдущей сцены
  });
 Game.start("Menu"); 

} //end init...

} //game object

 var count = 0; var count_viewport=false;
$(document).ready(function() {
  $('.sitescopy').remove();
  Game.init();
});
function clickMenuFunc(){ //меню
	console.log("И clickMenuFunc() срабатывает");
	for(i=0; i<coord_arr.length; i++){
		keys_arr.push(i); PutFunc(i);
	}
}
function PutFunc(i){
	$(".users_click"+i).click(function(){
	//$(".test").append("coord x= "+coord_arr[i][0]+", coord y= "+coord_arr[i][1]+" a i = "+i+"<br>");
	red_target.tween({x:coord_arr[i][0], y:coord_arr[i][1]}, 500);
	})
.mouseover(function(){
	if(!count_viewport) {
		Crafty.viewport.follow(yellow_target, 0, -100); yellow_target.alpha=1; red_target.alpha=1; count_viewport=true;
	}
$('.users_click'+i+' .users').css({'background-color': '#0033cc', 'color': '#ffffff'}); //выделение пт-ов меню
yellow_target.tween({x:coord_arr[i][0] - 2.5, y:coord_arr[i][1] - 2.5}, 500);
	})
.mouseout(function(){$('.users_click'+i+' .users').css({'background-color': '#fff', 'color': '#000'});});
}

function slideToggleDiv(){ //стрелка на списке
$('.hide_list').slideToggle(500);
if(count == 0) {
$(".arrow").rotate(90);
count = 1;
}
else {
$(".arrow").rotate(0);
count = 0;
}
}
</script>
</body>
</html>
